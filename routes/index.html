<!doctype html>
<html ng-app="myApp">
  <head>
    <title>{{title}}</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
	<script src="https://cdn.socket.io/socket.io-1.3.5.js"></script>
	<script src="http://localhost:3000/socket.io/socket.io.js"></script>
	 <script>
	  var app = angular.module('myApp', []);

		 app.factory('socket', ['$rootScope', function($rootScope) {
         var socket = io.connect();

		  return {
			on: function(eventName, callback){
			  socket.on(eventName, callback);
			},
			emit: function(eventName, data) {
			  socket.emit(eventName, data);
			}
		  };
       }])
		 
	  app.controller('myCtrl',function($scope,socket,$http){
	      $scope.message = 'Science';
		  //$scope.newMessages = [];
		  $scope.books = [];
		  $http.get('http://localhost:3000/books').then(function(response){
		       //console.log(response.data);
			  $scope.books=response.data;
		  })  
		  
		  $scope.join = function() {
			//console.log('Data sending ===> '+$scope.message);
			var obj = {
			     'title':$scope.message,
				 'author':'Vasim',
				 'isbn':'12-100' 
			}
			socket.emit('add-message',obj);
		  };
          
		  socket.on('notification', function(data) {
			//console.log('Data coming ===> ',data);  
			$scope.$apply(function () {
			   $scope.books.push(data);
			});
		  });
		  
	  });
		 
	  </script>
  </head>
	
  <body ng-controller="myCtrl">
	            <input type="text" ng-model="message">
	           <button ng-click="join();">Send</button>
	  <h1>New Messages: </h1>
	  <table>
	  <tr ng-repeat="book in books">
	      <td ng-bind="book.title"></td>	  
	  </tr>
	  </table>
  </body>
	
</html>

