<!--<html>
	<head>
	   <title>{{title}}</title>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
		<script src="http://localhost:3000/socket.io/socket.io.js"></script>
</head>
<body ng-app="myApp" ng-controller="myCtrl">
	           <input type="text" ng-model="message">
	           <button ng-click="sendMessage();">Send</button>
</body>
	<script>
var app = angular.module('myApp', []);
	
/**
 * Create a service for the socket
 */
/*app.factory('socket', function ($rootScope) {
  var socket = io.connect();
  return {
    on: function (eventName, callback) {
      socket.on(eventName, function () {
        var args = arguments;
        $rootScope.$apply(function () {
          callback.apply(socket, args);
        });
      });
    },
    emit: function (eventName, data, callback) {
      socket.emit(eventName, data, function () {
        var args = arguments;
        $rootScope.$apply(function () {'
          if (callback) {
            callback.apply(socket, args);
          }
        });
      })
    }
  };
});
	*/
app.controller('myCtrl', function($scope,socket) {
		/*socket.on('send:getBooks',function(data){
			   console.log('Data came from socket ====>'+data);
		})
*/		$scope.sendMessage = function(){
		   console.log('Message send : '+$scope.message);	
		   //socket.emit('send:message', {
           //message: $scope.message
        }//);

		}
});
</script>
</html>
-->

<!doctype html>
<html ng-app="myApp">
  <head>
    <title>{{title}}</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
	<script src="https://cdn.socket.io/socket.io-1.3.5.js"></script>
	<script src="http://localhost:3000/socket.io/socket.io.js"></script>
	 <script>
	  var app = angular.module('myApp', []);
		  /*app.factory('socket', function ($rootScope) {
		  var socket = io.connect();
		  return {
			on: function (eventName, callback) {
			  socket.on(eventName, function () {
				var args = arguments;
				$rootScope.$apply(function () {
				  callback.apply(socket, args);
				});
			  });
			},
			emit: function (eventName, data, callback) {
			  socket.emit(eventName, data, function () {
				var args = arguments;
				$rootScope.$apply(function () {'
				  if (callback) {
					callback.apply(socket, args);
				  }
				});
			  })
			}
		  };
		});*/
          app.factory('socket', ['$rootScope', function($rootScope) {
                         var socket = io.connect();
			    return {
				on: function(eventName, callback){
				  socket.on(eventName, callback);
				},
				emit: function(eventName, data) {
				  socket.emit(eventName, data);
				}
			  };
           }])
	  app.controller('myCtrl',function($scope,socket,$http){
	      $scope.message = 'Science';
		  //$scope.newMessages = [];
		  $scope.books = [];
		  $http.get('http://localhost:3000/books').then(function(response){
		       //console.log(response.data);
			  $scope.books=response.data;
		  })          
		  $scope.join = function() {
			console.log('Data sending ===> '+$scope.message);
			var obj = {
			     'title':$scope.message,
				 'author':'Vasim',
				 'isbn':'12-100' 
			}
			socket.emit('add-message',obj);
		  };

		  socket.on('notification', function(data) {
			console.log('Data coming ===> ',data);  
			$scope.$apply(function () {
			   $scope.books.push(data);
			});
		  });
	  });	 
	  </script>
  </head>
  <body ng-controller="myCtrl">
	            <input type="text" ng-model="message">
	           <button ng-click="join();">Send</button>
	  <h1>New Messages: </h1>
	  <table>
	  <tr ng-repeat="book in books">
	      <td ng-bind="book.title"></td>	  
	  </tr>
	  </table>
  </body>
</html>
